<div class="ui bottom attached tab segment" data-tab="categories">
  <div class="page-heading">
    <h2>Custom Categories</h2>

    <div class="heading-buttons">
      <%=
        link_to(
          download_product_data_experiment_conditions_path(
            experiment.id,
            condition.id,
            format: :csv
          ),
          class: 'ui right floated button'
          ) do
      %>
        <i class="download icon"></i> Download Product Data
      <% end %>
    </div>
  </div>

  <div class="page-sub-heading">
    <strong>Instructions: </strong>
  </div>
  <div>
    To add custom categories and subcategories, download the product data using the button above.
    Once you have added the custom categories, re-upload the file below and save.
    The categories added in the file will appear on the left below.
    The current file will appear on the left with a check box next to it. To remove the current file,
    uncheck the box. To replace the file, just upload a new one. Removed and replaced files will appear
    on the right below.
  </div>

  <div class="ui hidden divider"></div>

  <div class="ui basic segment two fields">
    <div class="field" data-current-csv>
      <label>Current file</label>
      <% if condition.current_tag_csv_file %>
        <%= link_to condition.current_tag_csv_file.to_s, condition.current_tag_csv_file.url %>
        <div class="ui checkbox">
          <%=
            f.check_box(
              :current_csv_file_active,
              value: true,
              data: { refresh_form: true }
            )
          %>
        </div>
      <% else %>
        None
      <% end %>
    </div>

    <div class="field">
      <%= f.label :csv_file, 'Replace file' %>
      <%= f.file_field :csv_file %>
    </div>
  </div>

  <div class="ui hidden divider"></div>

  <div class="ui grid">
    <div class="eight wide column">
      <h4>Active categories and subcategories</h4>
      <table class="ui celled table">
        <thead>
          <tr>
            <th class="eight wide">Category</th>
            <th class="eight wide">Subcategory</th>
          </tr>
        </thead>

        <tbody>
          <% product_tags = condition.product_tags %>
          <% if product_tags.any? %>
            <% product_tags.each do |product_tag| %>
              <tr>
                <td>
                  <%= product_tag.tag %>
                </td>
                <td>
                  <%= product_tag.subtag %>
                </td>
              </tr>
            <% end %>
          <% else %>
            <tr>
              <td colspan="2" class="center aligned">
                No data
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <div class="eight wide column">
      <h4>Previously uploaded files</h4>
      <table class="ui celled table" data-historical-csvs>
        <thead>
          <tr>
            <th class="ten wide">File</th>
            <th class="six wide">Uploaded on</th>
          </tr>
        </thead>

        <tbody>
          <% csv_files = condition.historical_tag_csv_files %>
          <% if csv_files.any? %>
            <% csv_files.each do |file| %>
              <tr>
                <td>
                  <%= link_to file.to_s, file.url %>
                </td>
                <td>
                  <%= file.created_at.to_date %>
                </td>
              </tr>
            <% end %>
          <% else %>
            <tr>
              <td colspan="2" class="center aligned">
                No data
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <div class="ui divider"></div>

  <div class="ui basic segment">
    <h3>Additional Categories</h3>
    <h4>Allow users to browse these additional categories:</h4>

    <div class="ui three fields">
      <div class="field">
        <div class="ui radio checkbox">
          <input type="checkbox">
          <label>WIC approved</label>
        </div>
      </div>
      <div class="field">
        <div class="ui radio checkbox">
          <input type="checkbox">
          <label>Eating disorder recovery</label>
        </div>
      </div>
      <div class="field">
        <div class="ui radio checkbox">
          <input type="checkbox">
          <label>Locally sourced</label>
        </div>
      </div>
    </div>
    <div class="ui three fields">
      <div class="field">
        <div class="ui radio checkbox">
          <input type="checkbox">
          <label>SNAP approved</label>
        </div>
      </div>
      <div class="field">
        <div class="ui radio checkbox">
          <input type="checkbox">
          <label>Ketogenic diet</label>
        </div>
      </div>
      <div class="field">
        <div class="ui radio checkbox">
          <input type="checkbox">
          <label>Organic</label>
        </div>
      </div>
    </div>
  </div>
</div>
