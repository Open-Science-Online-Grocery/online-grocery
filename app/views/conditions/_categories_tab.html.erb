<div class="ui bottom attached tab segment" data-tab="categories">
  <div class="page-heading">
    <h2>Custom Categories</h2>

    <div class="heading-buttons">
      <%=
        link_to(
          custom_categories_product_download_path,
          class: 'ui right floated button',
          data: { loading_spinner: true, remote: true }
        ) do
      %>
        <i class="download icon"></i> Download Product Data
      <% end %>
    </div>
  </div>

  <div class="page-sub-heading">
    <strong>Instructions: </strong>
  </div>
  <div>
    To add custom categories and subcategories, download the product data using the button above.
    Once you have added the custom categories, re-upload the file below and save.
    The categories added in the file will appear on the left below.
    The current file will appear on the left with a check box next to it. To remove the current file,
    uncheck the box. To replace the file, just upload a new one. Removed and replaced files will appear
    on the right below.
  </div>

  <div class="ui hidden divider"></div>

  <div class="two fields">
    <div class="field" data-current-csv>
      <label>Current file</label>
      <% if condition.current_tag_csv_file %>
        <%= condition.current_tag_csv_file_presenter.download_link %>

        <%= f.fields_for :current_tag_csv_file do |tag_csv_fields| %>
          <div class="ui checkbox">
            <%= tag_csv_fields.check_box(:active) %>
          </div>
        <% end %>
      <% else %>
        None
      <% end %>
    </div>

     <%= f.fields_for :tag_csv_files, TagCsvFile.new do |new_tag_csv_fields| %>
      <div class="field">
        <%= new_tag_csv_fields.label :csv_file, 'Replace file' %>
        <%= new_tag_csv_fields.file_field :csv_file %>
      </div>
    <% end %>
  </div>

  <div class="ui hidden divider"></div>

  <div class="ui grid">
    <div class="eight wide column">
      <h4>Active categories and subcategories</h4>
      <table class="ui celled table">
        <thead>
          <tr>
            <th class="eight wide">Category</th>
            <th class="eight wide">Subcategory</th>
          </tr>
        </thead>

        <tbody>
          <% unique_tag_combinations = condition.unique_tag_combinations %>
          <% if unique_tag_combinations.any? %>
            <% unique_tag_combinations.each do |tag_combination| %>
              <tr>
                <td>
                  <%= tag_combination[0] %><%# tag %>
                </td>
                <td>
                  <%= tag_combination[1] %><%# subtag %>
                </td>
              </tr>
            <% end %>
          <% else %>
            <tr>
              <td colspan="2" class="center aligned">
                No data
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <div class="eight wide column">
      <h4>Previously uploaded files</h4>
      <table class="ui celled table" data-historical-csvs>
        <thead>
          <tr>
            <th class="ten wide">File</th>
            <th class="six wide">Uploaded on</th>
          </tr>
        </thead>

        <tbody>
          <% if condition.historical_tag_csv_files_presenters.any? %>
            <% condition.historical_tag_csv_files_presenters.each do |file| %>
              <tr>
                <td>
                  <%= file.download_link %>
                </td>
                <td>
                  <%= l(file.created_at.to_date) %>
                </td>
              </tr>
            <% end %>
          <% else %>
            <tr>
              <td colspan="2" class="center aligned">
                No data
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <div class="ui hidden divider"></div>

  <div class="field">
    <div class="ui checkbox">
      <%= f.check_box :filter_by_custom_categories %>
      <%= f.label :filter_by_custom_categories, 'Allow users to filter store-wide by custom categories'%>
    </div>
  </div>
</div>
